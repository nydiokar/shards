# Pipelight Pipeline: Swab the Deck with Free-Tier AI
## Scheduled Hecke-Maass Sharding + AI Analysis

triggers:
  - name: daily_swab
    cron: "0 2 * * *"  # 2 AM daily
  - name: on_push
    branch: main

pipelines:
  swab_deck:
    steps:
      - name: swab_rust
        commands:
          - cd swab-deck && cargo run --release -- all
      
      - name: analyze_with_gemini
        commands:
          - nix develop .#gemini-cli -c gemini-analyze-shards
      
      - name: analyze_with_claude
        commands:
          - nix develop .#claude-cli -c claude-analyze-shards
      
      - name: analyze_with_gpt
        commands:
          - nix develop .#openai-cli -c gpt-analyze-shards
      
      - name: analyze_with_llama
        commands:
          - nix develop .#ollama -c ollama-analyze-shards
      
      - name: consensus
        commands:
          - python3 ai_consensus.py
      
      - name: commit_results
        commands:
          - git add HECKE_MAASS_MANIFEST.json AI_ANALYSIS.json
          - git commit -m "chore: swab deck $(date +%Y-%m-%d)" || true
          - git push || true
  
  moltbook_register:
    steps:
      - name: build_rust
        commands:
          - cd cicada-moltbook && cargo build --release
      
      - name: verify_lean4
        commands:
          - echo "Lean4 verification (requires lean4 installation)"
          - echo "✓ Skipped (lean4 not in PATH)"
      
      - name: check_prolog
        commands:
          - echo "Prolog validation (requires swipl)"
          - echo "✓ Skipped (swipl not in PATH)"
      
      - name: register_agents
        commands:
          - cd cicada-moltbook && cargo run --release -- register
      
      - name: show_examples
        commands:
          - cd cicada-moltbook && cargo run --release -- examples
      
      - name: check_status
        commands:
          - python3 check_moltbook_status.py

options:
  detach: false
  log_level: info
