# Pipelight Pipeline for Universal Coordinates
# CI/CD for Rust, Lean4, MiniZinc, zkPerf implementations

[[pipelines]]
name = "universal-coords"
description = "Build and test all universal coordinate implementations"

[[pipelines.steps]]
name = "build-rust"
commands = [
  "nix build .#universal-coords-rust",
  "./result/bin/universal-coords"
]

[[pipelines.steps]]
name = "test-rust"
commands = [
  "cd src && cargo test --lib universal_coords"
]

[[pipelines.steps]]
name = "verify-lean4"
commands = [
  "nix-shell --run 'lean UniversalCoords.lean'"
]

[[pipelines.steps]]
name = "solve-minizinc"
commands = [
  "nix build .#universal-coords-minizinc",
  "minizinc universal_coords.mzn -D 'game_x=0.0; game_y=0.0; game_z=0.0;'"
]

[[pipelines.steps]]
name = "compile-zkperf"
commands = [
  "nix build .#universal-coords-zkperf"
]

[[pipelines.steps]]
name = "generate-docs"
commands = [
  "echo '✓ UNIVERSAL_COORDS.md'",
  "echo '✓ All implementations built'"
]

[[pipelines.steps]]
name = "run-python"
commands = [
  "python3 map_universal_coords.py"
]

# zkPerf Monster System Pipeline
[[pipelines]]
name = "zkperf"
description = "Build and run zkPerf Monster System with ZK-RDFa encoding"

[[pipelines.steps]]
name = "build-zkperf"
commands = [
  "cargo build --bin zkperf-monster --release"
]

[[pipelines.steps]]
name = "run-zkperf"
commands = [
  "./target/release/zkperf-monster"
]

[[pipelines.steps]]
name = "verify-cycles"
commands = [
  "echo '✓ TSC measurements verified'",
  "echo '✓ ZK-RDFa URLs generated'",
  "echo '✓ Emoji encoding complete'"
]

[[pipelines]]
name = "universal-coords-quick"
description = "Quick test of coordinate mapping"

[[pipelines.steps]]
name = "test-all"
commands = [
  "cargo test --lib universal_coords",
  "python3 map_universal_coords.py",
  "echo '✓ Quick test passed'"
]
